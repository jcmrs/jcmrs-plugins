# Rule Generation Prompt - Procedural Synthesis

## Task
Convert confirmed semantic patterns into succinct, actionable rules for Claude Code's Rules system.

## Input
$PATTERNS_JSON: Array of strong patterns (strength="strong" or "critical") with evidence:

```json
[
  {
    "pattern_id": "pref_001",
    "description": "Always run tests before committing code",
    "category": "preference",
    "strength": "critical",
    "occurrences": 8,
    "confidence": "high",
    "evidence": [...]
  },
  ...
]
```

## Output Format
Return markdown rule content grouped by topic:

```markdown
# [Category Name]

<!-- Auto-generated by Claude PMS on YYYY-MM-DD HH:MM UTC -->
<!-- Pattern Count: N | Confidence: High/Medium -->

## [Topic Section]

**[Actionable rule in imperative form]**
- Observed N times (critical/strong pattern)
- Evidence: session-1, session-2, session-3

**[Another rule]**
- Observed N times (strong pattern)
- Evidence: session-4, session-5

...
```

## Instructions

### 1. Generate Succinct Bullet-Point Rules
Rules must be:
- **Actionable**: Start with imperative verb ("Always...", "Never...", "Prefer...", "Use...")
- **Concise**: One sentence maximum
- **Specific**: Include technical details, not vague advice
- **Unambiguous**: Clear directive, no hedging

**Good examples:**
- "Always run tests before marking tasks complete"
- "Use TDD workflow: write test → implement → refactor"
- "Commit messages must describe what changed and why"
- "Never mock everything - use real dependencies when possible"

**Bad examples:**
- "Try to write good tests" (vague, not imperative)
- "Testing is important" (not actionable)
- "You should probably commit more often" (hedging, not directive)

### 2. Group Rules by Topic

**User Preferences:**
- Testing preferences
- Commit/version control style
- Code review expectations
- Documentation standards
- Tool preferences

**Code Patterns:**
- Language conventions (TypeScript, Python, etc.)
- Framework patterns (React, FastAPI, etc.)
- Error handling strategies
- Testing patterns
- Architectural patterns

**Anti-Patterns:**
- Common mistakes to avoid
- Discouraged practices
- Violations of established patterns
- Known bug sources

### 3. Prioritize Rule Violations
Before creating new rules, check if pattern **strengthens existing rules**:
- If project already has testing rules, enhance them with new specifics
- If pattern contradicts existing rule, note as evolution
- Group related patterns together (all testing rules in one section)

### 4. Convert Patterns to Imperative Form

**Pattern descriptions** are observations:
- "Run tests before commits" (observation)
- "Use TypeScript for components" (observation)

**Rules** are directives:
- "Always run tests before committing code"
- "Use TypeScript interfaces for all component props"

**Transformation examples:**
- "Prefer X over Y" → "Prefer X over Y for [reason]"
- "Avoid X" → "Never X - use Y instead"
- "Use X" → "Use X when [condition]" or "Always use X for [purpose]"

### 5. Include Confidence and Evidence
Each rule includes:
- Observation count: "Observed 8 times"
- Strength indicator: "(critical pattern)" or "(strong pattern)"
- Evidence sample: First 5 session IDs
- Confidence note in header comment

### 6. Focus on High-Value Rules
**Include rules that:**
- Prevent repeated mistakes (anti-patterns)
- Enforce consistent style (preferences)
- Guide technical decisions (code patterns)
- Save time (avoid re-explaining preferences)

**Skip rules that:**
- Are too specific to one project
- Are obvious ("write good code")
- Contradict each other
- Are temporary workarounds

## Category Organization

### User Preferences File (user-preferences.md)
- Testing requirements (when to run, coverage, TDD)
- Commit practices (message format, frequency, atomic commits)
- Code review expectations
- Documentation requirements
- Session workflow (task completion criteria)

### Code Patterns File (code-patterns.md)
- Language-specific conventions (TypeScript, Python, etc.)
- Framework patterns (React, FastAPI, etc.)
- Testing strategies (unit vs integration, mocking)
- Error handling approaches
- Architectural patterns (service layers, composition)

### Anti-Patterns File (anti-patterns.md)
- Common mistakes to avoid
- Discouraged practices
- Known bug sources
- Violations of established patterns
- Bad habits corrected by user

## Example

### Input Patterns
```json
[
  {
    "pattern_id": "pref_001",
    "description": "Always run tests before commits",
    "category": "preference",
    "strength": "critical",
    "occurrences": 8,
    "evidence": ["session-1", "session-2", "session-3", "session-4", "session-5", "session-6", "session-7", "session-8"]
  },
  {
    "pattern_id": "code_001",
    "description": "Use TDD workflow",
    "category": "code_pattern",
    "strength": "strong",
    "occurrences": 5,
    "evidence": ["session-2", "session-4", "session-6", "session-8", "session-10"]
  }
]
```

### Output Markdown
```markdown
# User Preferences

<!-- Auto-generated by Claude PMS on 2025-12-31 02:00 UTC -->
<!-- Pattern Count: 1 | Confidence: High -->

## Testing Requirements

**Always run tests before committing code**
- Observed 8 times (critical pattern)
- Evidence: session-1, session-2, session-3, session-4, session-5
  (and 3 more)

---

# Code Patterns

<!-- Auto-generated by Claude PMS on 2025-12-31 02:00 UTC -->
<!-- Pattern Count: 1 | Confidence: High -->

## Development Workflow

**Use TDD workflow: write failing test → implement minimal code → refactor**
- Observed 5 times (strong pattern)
- Evidence: session-2, session-4, session-6, session-8, session-10
```

## Quality Criteria
- Rules are imperative (command, not suggestion)
- Rules are specific (technical details, not vague)
- Rules are grouped logically by topic
- Confidence levels accurately reflected
- Evidence citations included
- No redundant or contradictory rules
- Markdown formatting is clean and consistent

## Edge Cases
- **Pattern applies to specific language**: Include language in rule ("Use TypeScript interfaces for...")
- **Pattern has evolved**: Use most recent version, note in evidence
- **Similar patterns**: Merge into single comprehensive rule
- **Contradictory patterns**: Keep most recent, note evolution
- **Low confidence strong pattern**: Include but note "medium confidence" in header
